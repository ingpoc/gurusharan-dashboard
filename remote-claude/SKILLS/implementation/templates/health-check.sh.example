#!/bin/bash
# TEMPLATE: health-check.sh
#
# Purpose: Verify implementation is healthy
#
# CUSTOMIZE THIS for your project:
# - If frontend only: check npm dev server, tests
# - If API only: check fastapi/flask health endpoint, database
# - If monorepo: check each service independently
# - If blockchain: check validator, RPC endpoint
#
# Exit codes:
#   0 = healthy
#   1 = broken (critical failure)

set -e

echo "Checking implementation health..."

# ============================================================================
# EXAMPLE 1: Frontend + Backend API (monorepo)
# Customize ports, endpoints, and services for YOUR project
# ============================================================================

# Check frontend dev server
if ! curl -sf http://localhost:3000 > /dev/null 2>&1; then
  echo "FAIL: Frontend not responding on :3000" >&2
  echo "  Start with: cd frontend && npm run dev" >&2
  exit 1
fi

# Check backend API
if ! curl -sf http://localhost:8000/health > /dev/null 2>&1; then
  echo "FAIL: Backend not responding on :8000" >&2
  echo "  Start with: cd gateway && uvicorn app.main:app --reload" >&2
  exit 1
fi

# ============================================================================
# EXAMPLE 2: Run tests (if they exist)
# Adjust test command for your project (pytest, jest, etc)
# ============================================================================

if [ -f "pytest.ini" ] || [ -d "tests/" ]; then
  if ! pytest --tb=short -q 2>/dev/null; then
    echo "FAIL: Tests failing" >&2
    exit 1
  fi
fi

if [ -f "package.json" ]; then
  if ! npm test -- --passWithNoTests 2>/dev/null; then
    echo "FAIL: Frontend tests failing" >&2
    exit 1
  fi
fi

# ============================================================================
# EXAMPLE 3: Multi-service (uncomment if needed)
# ============================================================================

# Solana validator (if running locally)
# if pgrep -f "solana-test-validator" > /dev/null; then
#   if ! solana ping -u localhost > /dev/null 2>&1; then
#     echo "FAIL: Solana validator down" >&2
#     exit 1
#   fi
# fi

# MCP servers (check processes)
# if ! pgrep -f "mcp-" > /dev/null; then
#   echo "FAIL: No MCP servers running" >&2
#   exit 1
# fi

# ============================================================================

echo "âœ“ All health checks passed"
exit 0
