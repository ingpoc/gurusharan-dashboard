generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model ChatSession {
  id        String   @id @default(cuid())
  messages  String   @default("[]")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Draft {
  id          String    @id @default(cuid())
  content     String
  metadata    String?   @default("{}")
  scheduledAt DateTime?
  status      String    @default("DRAFT")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Post {
  id          String   @id @default(cuid())
  tweetId     String   @unique
  content     String
  postedAt    DateTime
  likes       Int      @default(0)
  retweets    Int      @default(0)
  replies     Int      @default(0)
  impressions Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Persona {
  id             String        @id @default(cuid())
  name           String
  topics         String        @default("[]")
  tone           String
  style          String
  hashtagUsage   Boolean       @default(true)
  emojiUsage     Boolean       @default(false)
  isActive       Boolean       @default(false)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  workflowRuns   WorkflowRun[]
  scheduledJobs  ScheduledJob[]
  settingsAsActive Settings[]  @relation("SettingsActivePersona")
}

model Settings {
  id                 String             @id @default(cuid())
  activePersonaId    String?
  activePersona      Persona?           @relation("SettingsActivePersona", fields: [activePersonaId], references: [id])
  xUserId            String?            @unique
  xUsername          String?
  xAccessToken       String?
  xRefreshToken      String?
  xTokenExpiry       DateTime?
  autonomousEnabled  Boolean            @default(false)
  frequency          Int                @default(3)
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
}

model ResearchCache {
  id        String   @id @default(cuid())
  topic     String
  results   String
  source    String   @default("tavily")
  cachedAt  DateTime @default(now())
  expiresAt DateTime
  @@index([topic])
  @@index([expiresAt])
}

model WorkflowRun {
  id           String   @id @default(cuid())
  status       String   @default("PENDING")
  phase        String   @default("IDLE")
  personaId    String
  persona      Persona  @relation(fields: [personaId], references: [id])
  postsCreated Int      @default(0)
  creditsUsed  Int      @default(0)
  error        String?
  startedAt    DateTime @default(now())
  completedAt  DateTime?
  @@index([status])
  @@index([startedAt])
}

model PostAnalytics {
  id            String   @id @default(cuid())
  postId        String   @unique
  likes         Int      @default(0)
  retweets      Int      @default(0)
  replies       Int      @default(0)
  uniqueAngle   String?
  personalVoice Boolean  @default(false)
  valueAdd      String?
  checkedAt     DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model ScheduledJob {
  id             String    @id @default(cuid())
  name           String
  cronExpression String
  timezone       String    @default("UTC")
  frequency      Int       @default(3)
  personaId      String?
  persona        Persona?  @relation(fields: [personaId], references: [id])
  enabled        Boolean   @default(true)
  lastRunAt      DateTime?
  nextRunAt      DateTime?
  runCount       Int       @default(0)
  lastStatus     String?
  lastError      String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  @@index([enabled])
  @@index([nextRunAt])
}
